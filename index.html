<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Escolha seu Presente</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <!-- Biblioteca para efeito de fogos -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background-image: url('https://i.imgur.com/sNvEbho.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      max-width: 600px;
      margin: auto;
      margin-top: 30px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 10px;
    }

    button {
      padding: 20px;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      transition: 0.3s;
    }

    button.disponivel {
      background-color: #4CAF50;
      color: white;
    }

    button.ocupado {
      background-color: #e53935;
      color: white;
    }

    button.bloqueado {
      background-color: #ccc;
      color: #666;
      cursor: not-allowed;
    }

    button:hover:not([disabled]) {
      opacity: 0.9;
    }

    #resultado img {
      max-width: 200px;
      margin-top: 10px;
      border-radius: 10px;
    }

    h2, h3 {
      background-color: rgba(0, 0, 0, 0.5);
      display: inline-block;
      padding: 10px 20px;
      border-radius: 10px;
    }

    #nomeForm {
      margin-top: 20px;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }

    #confirmarBtn {
      padding: 10px 20px;
      margin-left: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Escolha um número de 1 a 26</h2>

  <div id="nomeForm">
    <input type="text" id="nome" placeholder="Digite seu nome completo" />
    <button id="confirmarBtn">Confirmar Nome</button>
  </div>

  <div class="grid" id="botoes"></div>
  <div id="resultado"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDGYG-8_l33T3443dv74yV-EW5RsvuytUM",
      authDomain: "presentes-824c6.firebaseapp.com",
      databaseURL: "https://presentes-824c6-default-rtdb.firebaseio.com",
      projectId: "presentes-824c6",
      storageBucket: "presentes-824c6.firebasestorage.app",
      messagingSenderId: "919725642683",
      appId: "1:919725642683:web:cd1e487df9e725878eea9e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const botoesContainer = document.getElementById("botoes");
    const resultado = document.getElementById("resultado");
    const nomeInput = document.getElementById("nome");
    const confirmarBtn = document.getElementById("confirmarBtn");

    let nomeUsuario = "";
    let ocupadosGlobais = {};
    let usuarioJaEscolheu = false;

    const presentes = [
      { texto: "Escorredor de Macarrão", imagem: "https://i.imgur.com/t1s7ZNM.png" },
      { texto: "Forma de Pizza", imagem: "https://i.imgur.com/USOfXpC.jpeg" },
      { texto: "Frigideira", imagem: "https://i.imgur.com/LDQP3QM.png" },
      { texto: "Forma de Pudim", imagem: "https://i.imgur.com/2587yVk.png" },
      { texto: "Jarra de Suco", imagem: "https://i.imgur.com/oGQVcLC.jpeg" },
      { texto: "Jogo de Assadeiras", imagem: "https://i.imgur.com/7JetlZK.jpeg" },
      { texto: "Marinex com Tampa", imagem: "https://i.imgur.com/9ajS3Yp.png" },
      { texto: "Boleira", imagem: "https://i.imgur.com/GcQoXA3.png" },
      { texto: "Lixeira de Cozinha", imagem: "https://i.imgur.com/Acb2WaU.png" },
      { texto: "Kit Utensílios de Cozinha", imagem: "https://i.imgur.com/PnhSpCm.png" },
      { texto: "Pipoqueira Simples", imagem: "https://i.imgur.com/aUuZDwt.png" },
      { texto: "Panela de Pressão Pequena", imagem: "https://i.imgur.com/GixdOUt.jpeg" },
      { texto: "Escorredor de Louças", imagem: "https://i.imgur.com/mUO4Zk2.png" },
      { texto: "Baldes", imagem: "https://i.imgur.com/CAg8deY.png" },
      { texto: "Bacias para Lavar Roupa", imagem: "https://i.imgur.com/zTfEmx8.jpeg" },
      { texto: "Cesto de Roupa Suja", imagem: "https://i.imgur.com/O5G158d.jpeg" },
      { texto: "Jogo de Taças", imagem: "https://i.imgur.com/BPrNsG2.png" },
      { texto: "Jogo de Xícaras", imagem: "https://i.imgur.com/4hujTMJ.png" },
      { texto: "Sanduicheira", imagem: "https://i.imgur.com/dICDLLj.png" },
      { texto: "Lixeira para Banheiro", imagem: "https://i.imgur.com/P5HSaur.png" },
      { texto: "Triturador de Temperos", imagem: "https://i.imgur.com/KwH1xVI.jpeg" },
      { texto: "Pratinhos de Sobremesa", imagem: "https://i.imgur.com/3qwXiFb.jpeg" },
      { texto: "Descanso de Panela", imagem: "https://i.imgur.com/2VlmhV3.png" },
      { texto: "Jogo Americano", imagem: "https://i.imgur.com/NHS85xd.png" },
      { texto: "Saca Rolha, Cortador para Bolo e Cortador para Pizza", imagem: "https://i.imgur.com/XcbSyQz.jpeg" },
      { texto: "Fruteira", imagem: "https://i.imgur.com/ZlwGcdD.jpeg" }
    ];

    confirmarBtn.onclick = () => {
      const nome = nomeInput.value.trim();
      if (!nome) {
        alert("Por favor, insira seu nome completo.");
        return;
      }

      nomeUsuario = nome;

      db.ref("usuarios").orderByValue().equalTo(nomeUsuario).once("value", snapshot => {
        if (snapshot.exists()) {
          alert("Este nome já foi utilizado para escolher um presente.");
          usuarioJaEscolheu = true;
          criarBotoes(ocupadosGlobais, true);
        } else {
          criarBotoes(ocupadosGlobais, false);
        }
      });
    };

    function criarBotoes(ocupados, bloquearTodos) {
      botoesContainer.innerHTML = "";
      for (let i = 1; i <= 26; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;

        if (bloquearTodos) {
          btn.disabled = true;
          if (ocupados[i]) {
            btn.classList.add("ocupado");
          } else {
            btn.classList.add("bloqueado");
          }
        } else {
          if (ocupados[i]) {
            btn.disabled = true;
            btn.classList.add("ocupado");
          } else {
            btn.classList.add("disponivel");
            btn.onclick = () => escolherPresente(i);
          }
        }

        botoesContainer.appendChild(btn);
      }
    }

    // Função para efeito de fogos de artifício visual
    function fogos() {
      var duration = 2 * 1000;
      var animationEnd = Date.now() + duration;
      var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };

      function randomInRange(min, max) {
        return Math.random() * (max - min) + min;
      }

      var interval = setInterval(function() {
        var timeLeft = animationEnd - Date.now();

        if (timeLeft <= 0) {
          return clearInterval(interval);
        }

        var particleCount = 50 * (timeLeft / duration);
        confetti(Object.assign({}, defaults, {
          particleCount,
          origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
        }));
        confetti(Object.assign({}, defaults, {
          particleCount,
          origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
        }));
      }, 250);
    }

    function escolherPresente(numero) {
      if (!nomeUsuario) {
        alert("Por favor, insira seu nome primeiro.");
        return;
      }

      db.ref("escolhas/" + numero).once("value", snapshot => {
        if (snapshot.exists()) {
          alert("Esse número já foi escolhido!");
        } else {
          const presente = presentes[numero - 1];
          db.ref("escolhas/" + numero).set({ ...presente, nome: nomeUsuario });
          db.ref("usuarios").push(nomeUsuario);
          mostrarPresente(presente);
          fogos(); // Aqui dispara o efeito visual
          criarBotoes({ ...ocupadosGlobais, [numero]: true }, true);
        }
      });
    }

    function mostrarPresente(presente) {
      resultado.innerHTML = `
        <h3>Você ficou com o presente:</h3>
        <p>${presente.texto}</p>
        ${presente.imagem ? `<img src="${presente.imagem}" alt="Presente">` : ""}
      `;
    }

    db.ref("escolhas").on("value", snapshot => {
      ocupadosGlobais = {};
      const dados = snapshot.val();
      for (let num in dados) {
        ocupadosGlobais[num] = true;
      }
      if (nomeUsuario && !usuarioJaEscolheu) {
        criarBotoes(ocupadosGlobais, false);
      }
    });
  </script>
</body>
</html>
